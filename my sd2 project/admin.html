<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflix - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-image: url('https://static0.pocketlintimages.com/wordpress/wp-content/uploads/140219-tv-news-feature-netflix-tips-and-tricks-how-to-master-your-binge-watching-experience-image4-rivlhfwq6o.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #fff;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: -1;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-900">
    <!-- Navigation -->
    <nav class="bg-black px-4 md:px-12 py-4 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <div class="text-red-600 text-3xl font-bold">NETFLIX ADMIN</div>
            <div class="text-sm text-gray-400">Owner Panel</div>
        </div>
        <div class="flex items-center gap-4">
            <span class="text-gray-400" id="adminEmail"></span>
            <button onclick="handleLogout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">
                Logout
            </button>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-8">
        <!-- Dashboard Header -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold mb-2">Complete System Control</h1>
            <p class="text-gray-400">Full access to user management, analytics, and system administration</p>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-gradient-to-br from-yellow-600 to-yellow-700 p-6 rounded-lg shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-yellow-100 text-sm">Pending Requests</p>
                        <h3 class="text-3xl font-bold" id="pendingCount">0</h3>
                    </div>
                    <div class="text-5xl opacity-80">‚è≥</div>
                </div>
            </div>
            
            <div class="bg-gradient-to-br from-green-600 to-green-700 p-6 rounded-lg shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-green-100 text-sm">Approved Users</p>
                        <h3 class="text-3xl font-bold" id="approvedCount">0</h3>
                    </div>
                    <div class="text-5xl opacity-80">‚úÖ</div>
                </div>
            </div>
            
            <div class="bg-gradient-to-br from-blue-600 to-blue-700 p-6 rounded-lg shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-blue-100 text-sm">Total Users</p>
                        <h3 class="text-3xl font-bold" id="totalCount">0</h3>
                    </div>
                    <div class="text-5xl opacity-80">üë•</div>
                </div>
            </div>

            <div class="bg-gradient-to-br from-purple-600 to-purple-700 p-6 rounded-lg shadow-lg">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-purple-100 text-sm">Revenue (Est.)</p>
                        <h3 class="text-3xl font-bold">‡ß≥<span id="revenue">0</span></h3>
                    </div>
                    <div class="text-5xl opacity-80">üí∞</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <button onclick="exportUserData()" class="bg-gray-800 hover:bg-gray-700 p-4 rounded-lg text-left transition">
                <div class="text-2xl mb-2">üìä</div>
                <div class="font-semibold">Export All Data</div>
                <div class="text-sm text-gray-400">Download user database as JSON</div>
            </button>
            
            <button onclick="showSystemStats()" class="bg-gray-800 hover:bg-gray-700 p-4 rounded-lg text-left transition">
                <div class="text-2xl mb-2">üìà</div>
                <div class="font-semibold">System Analytics</div>
                <div class="text-sm text-gray-400">View detailed statistics</div>
            </button>
            
            <button onclick="clearAllData()" class="bg-red-900 hover:bg-red-800 p-4 rounded-lg text-left transition">
                <div class="text-2xl mb-2">üóëÔ∏è</div>
                <div class="font-semibold">Clear All Data</div>
                <div class="text-sm text-gray-400">Reset entire system</div>
            </button>
        </div>

        <!-- Tabs -->
        <div class="mb-6">
            <div class="flex gap-4 border-b border-gray-700 overflow-x-auto">
                <button id="pendingTab" class="tab-btn px-4 py-2 font-semibold border-b-2 border-red-600 text-red-600 whitespace-nowrap" onclick="switchTab('pending')">
                    Pending Requests
                </button>
                <button id="approvedTab" class="tab-btn px-4 py-2 font-semibold text-gray-400 hover:text-white whitespace-nowrap" onclick="switchTab('approved')">
                    Approved Users
                </button>
                <button id="allTab" class="tab-btn px-4 py-2 font-semibold text-gray-400 hover:text-white whitespace-nowrap" onclick="switchTab('all')">
                    All Users
                </button>
                <button id="plansTab" class="tab-btn px-4 py-2 font-semibold text-gray-400 hover:text-white whitespace-nowrap" onclick="switchTab('plans')">
                    Plans & Revenue
                </button>
            </div>
        </div>

        <!-- User Tables -->
        <div id="pendingTable" class="bg-gray-800 rounded-lg overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-900">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Avatar</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Name</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Email</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Phone</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Registered</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="pendingTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="approvedTable" class="hidden bg-gray-800 rounded-lg overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-900">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Avatar</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Name</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Email</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Plan</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Payment</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="approvedTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="allTable" class="hidden bg-gray-800 rounded-lg overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-900">
                        <tr>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Avatar</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Name</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Email</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Status</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Plan</th>
                            <th class="px-6 py-4 text-left text-sm font-semibold">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="allTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="plansTable" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Mobile Plan</h3>
                    <p class="text-3xl font-bold text-purple-500">‡ß≥299</p>
                    <p class="text-sm text-gray-400 mt-2"><span id="mobilePlanCount">0</span> users</p>
                </div>
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Basic Plan</h3>
                    <p class="text-3xl font-bold text-blue-500">‡ß≥499</p>
                    <p class="text-sm text-gray-400 mt-2"><span id="basicPlanCount">0</span> users</p>
                </div>
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Standard Plan</h3>
                    <p class="text-3xl font-bold text-green-500">‡ß≥899</p>
                    <p class="text-sm text-gray-400 mt-2"><span id="standardPlanCount">0</span> users</p>
                </div>
                <div class="bg-gray-800 p-6 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Premium Plan</h3>
                    <p class="text-3xl font-bold text-red-500">‡ß≥1,199</p>
                    <p class="text-sm text-gray-400 mt-2"><span id="premiumPlanCount">0</span> users</p>
                </div>
            </div>
            
            <div class="bg-gray-800 p-6 rounded-lg">
                <h3 class="text-xl font-semibold mb-4">Revenue Breakdown</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span>Mobile Plan Revenue:</span>
                        <span class="font-bold">‡ß≥<span id="mobileRevenue">0</span></span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Basic Plan Revenue:</span>
                        <span class="font-bold">‡ß≥<span id="basicRevenue">0</span></span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Standard Plan Revenue:</span>
                        <span class="font-bold">‡ß≥<span id="standardRevenue">0</span></span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>Premium Plan Revenue:</span>
                        <span class="font-bold">‡ß≥<span id="premiumRevenue">0</span></span>
                    </div>
                    <div class="border-t border-gray-700 pt-3 flex justify-between items-center text-lg">
                        <span class="font-semibold">Total Monthly Revenue:</span>
                        <span class="font-bold text-green-500">‡ß≥<span id="totalRevenue">0</span></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Detail Modal -->
    <div id="userModal" class="modal">
        <div class="bg-gray-800 rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">User Details</h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="userModalContent"></div>
        </div>
    </div>

    <footer class="bg-black mt-12 py-6 text-center">
        <p class="text-gray-400 text-sm">¬© 2025 Netflix Clone. All rights reserved. || For University Software Engineering and Development Course</p>
        <p class="text-gray-400 text-sm mt-2">Developed by <span class="text-red-600 font-semibold">Nazrana Nahreen</span></p>
    </footer>

    <script>
        const currentAdmin = JSON.parse(localStorage.getItem('currentAdmin') || 'null');
        if (!currentAdmin || currentAdmin.role !== 'admin') {
            alert('Unauthorized access! Please log in as admin.');
            window.location.href = 'signin.html';
        }

        document.getElementById('adminEmail').textContent = currentAdmin.email;

        const avatarEmojis = { '1': 'üòä', '2': 'üòé', '3': 'üé≠', '4': 'üé¨', '5': '‚≠ê', '6': 'üçø', '7': 'üé•', '8': 'üëë' };
        const avatarColors = { '1': 'bg-red-500', '2': 'bg-blue-500', '3': 'bg-green-500', '4': 'bg-purple-500', '5': 'bg-yellow-500', '6': 'bg-pink-500', '7': 'bg-indigo-500', '8': 'bg-orange-500' };

        function loadDashboard() {
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const pendingUsers = users.filter(u => !u.approved);
            const approvedUsers = users.filter(u => u.approved);
            
            document.getElementById('pendingCount').textContent = pendingUsers.length;
            document.getElementById('approvedCount').textContent = approvedUsers.length;
            document.getElementById('totalCount').textContent = users.length;
            
            calculateRevenue(approvedUsers);
            loadPendingTable(pendingUsers);
            loadApprovedTable(approvedUsers);
            loadAllTable(users);
            loadPlansStats(approvedUsers);
        }

        function calculateRevenue(users) {
            const planPrices = { 'mobile': 299, 'basic': 499, 'standard': 899, 'premium': 1199 };
            let total = 0;
            users.forEach(user => {
                const planName = user.planName ? user.planName.toLowerCase() : 'standard';
                total += planPrices[planName] || 899;
            });
            document.getElementById('revenue').textContent = total.toLocaleString('en-BD');
        }

        function loadPendingTable(users) {
            const tbody = document.getElementById('pendingTableBody');
            tbody.innerHTML = users.length === 0 
                ? '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-400">No pending requests</td></tr>'
                : users.map(user => `
                    <tr class="border-t border-gray-700 hover:bg-gray-700">
                        <td class="px-6 py-4">
                            <div class="w-12 h-12 ${avatarColors[user.avatar]} rounded-full flex items-center justify-center text-2xl">
                                ${avatarEmojis[user.avatar]}
                            </div>
                        </td>
                        <td class="px-6 py-4">${user.fullName}</td>
                        <td class="px-6 py-4">${user.email}</td>
                        <td class="px-6 py-4">${user.phone || 'N/A'}</td>
                        <td class="px-6 py-4">${new Date(user.registeredAt).toLocaleDateString()}</td>
                        <td class="px-6 py-4">
                            <button onclick="viewUser(${user.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm mr-1">View</button>
                            <button onclick="approveUser(${user.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm mr-1">Approve</button>
                            <button onclick="rejectUser(${user.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">Reject</button>
                        </td>
                    </tr>
                `).join('');
        }

        function loadApprovedTable(users) {
            const tbody = document.getElementById('approvedTableBody');
            tbody.innerHTML = users.length === 0 
                ? '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-400">No approved users</td></tr>'
                : users.map(user => `
                    <tr class="border-t border-gray-700 hover:bg-gray-700">
                        <td class="px-6 py-4">
                            <div class="w-12 h-12 ${avatarColors[user.avatar]} rounded-full flex items-center justify-center text-2xl">
                                ${avatarEmojis[user.avatar]}
                            </div>
                        </td>
                        <td class="px-6 py-4">${user.fullName}</td>
                        <td class="px-6 py-4">${user.email}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 bg-purple-600 rounded text-sm">${user.planName || 'Standard'}</span>
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 bg-green-600 rounded text-sm">${user.paymentMethod || 'Card'}</span>
                        </td>
                        <td class="px-6 py-4">
                            <button onclick="viewUser(${user.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm mr-1">View</button>
                            <button onclick="revokeAccess(${user.id})" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm mr-1">Revoke</button>
                            <button onclick="deleteUser(${user.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">Delete</button>
                        </td>
                    </tr>
                `).join('');
        }

        function loadAllTable(users) {
            const tbody = document.getElementById('allTableBody');
            tbody.innerHTML = users.length === 0 
                ? '<tr><td colspan="6" class="px-6 py-8 text-center text-gray-400">No users registered</td></tr>'
                : users.map(user => `
                    <tr class="border-t border-gray-700 hover:bg-gray-700">
                        <td class="px-6 py-4">
                            <div class="w-12 h-12 ${avatarColors[user.avatar]} rounded-full flex items-center justify-center text-2xl">
                                ${avatarEmojis[user.avatar]}
                            </div>
                        </td>
                        <td class="px-6 py-4">${user.fullName}</td>
                        <td class="px-6 py-4">${user.email}</td>
                        <td class="px-6 py-4">
                            <span class="px-3 py-1 rounded-full text-sm ${user.approved ? 'bg-green-600' : 'bg-yellow-600'}">
                                ${user.approved ? 'Approved' : 'Pending'}
                            </span>
                        </td>
                        <td class="px-6 py-4">${user.planName || 'Standard'}</td>
                        <td class="px-6 py-4">
                            <button onclick="viewUser(${user.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm mr-1">View</button>
                            ${!user.approved ? `<button onclick="approveUser(${user.id})" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm mr-1">Approve</button>` : ''}
                            <button onclick="deleteUser(${user.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">Delete</button>
                        </td>
                    </tr>
                `).join('');
        }

        function loadPlansStats(users) {
            const planCounts = { mobile: 0, basic: 0, standard: 0, premium: 0 };
            const planRevenues = { mobile: 0, basic: 0, standard: 0, premium: 0 };
            const planPrices = { mobile: 299, basic: 499, standard: 899, premium: 1199 };
            
            users.forEach(user => {
                const plan = (user.planName || 'standard').toLowerCase();
                planCounts[plan] = (planCounts[plan] || 0) + 1;
                planRevenues[plan] = (planRevenues[plan] || 0) + planPrices[plan];
            });
            
            document.getElementById('mobilePlanCount').textContent = planCounts.mobile;
            document.getElementById('basicPlanCount').textContent = planCounts.basic;
            document.getElementById('standardPlanCount').textContent = planCounts.standard;
            document.getElementById('premiumPlanCount').textContent = planCounts.premium;
            
            document.getElementById('mobileRevenue').textContent = planRevenues.mobile.toLocaleString('en-BD');
            document.getElementById('basicRevenue').textContent = planRevenues.basic.toLocaleString('en-BD');
            document.getElementById('standardRevenue').textContent = planRevenues.standard.toLocaleString('en-BD');
            document.getElementById('premiumRevenue').textContent = planRevenues.premium.toLocaleString('en-BD');
            
            const total = Object.values(planRevenues).reduce((a, b) => a + b, 0);
            document.getElementById('totalRevenue').textContent = total.toLocaleString('en-BD');
        }

        function viewUser(userId) {
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            const content = `
                <div class="space-y-4">
                    <div class="flex items-center gap-4 mb-6">
                        <div class="w-20 h-20 ${avatarColors[user.avatar]} rounded-full flex items-center justify-center text-4xl">
                            ${avatarEmojis[user.avatar]}
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold">${user.fullName}</h3>
                            <p class="text-gray-400">${user.email}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-700 p-4 rounded"><strong>Phone:</strong><br>${user.phone || 'N/A'}</div>
                        <div class="bg-gray-700 p-4 rounded"><strong>Status:</strong><br><span class="px-2 py-1 rounded ${user.approved ? 'bg-green-600' : 'bg-yellow-600'}">${user.approved ? 'Approved' : 'Pending'}</span></div>
                        <div class="bg-gray-700 p-4 rounded"><strong>Plan:</strong><br>${user.planName || 'Standard'}</div>
                        <div class="bg-gray-700 p-4 rounded"><strong>Price:</strong><br>‡ß≥${user.planPrice || '899'}/month</div>
                        <div class="bg-gray-700 p-4 rounded"><strong>Payment:</strong><br>${user.paymentMethod || 'N/A'}</div>
                        <div class="bg-gray-700 p-4 rounded"><strong>Mobile:</strong><br>${user.mobileNumber || 'N/A'}</div>
                        <div class="bg-gray-700 p-4 rounded col-span-2"><strong>Registered:</strong><br>${new Date(user.registeredAt).toLocaleString()}</div>
                        ${user.approvedAt ? `<div class="bg-gray-700 p-4 rounded col-span-2"><strong>Approved:</strong><br>${new Date(user.approvedAt).toLocaleString()}</div>` : ''}
                    </div>
                </div>
            `;
            
            document.getElementById('userModalContent').innerHTML = content;
            document.getElementById('userModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('userModal').classList.remove('active');
        }

        function approveUser(userId) {
            if (!confirm('Approve this user?')) return;
            let users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            users = users.map(user => user.id === userId ? { ...user, approved: true, approvedAt: new Date().toISOString() } : user);
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            alert('User approved!');
            loadDashboard();
        }

        function rejectUser(userId) {
            if (!confirm('Reject and delete this user?')) return;
            let users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            users = users.filter(user => user.id !== userId);
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            alert('User rejected!');
            loadDashboard();
        }

        function revokeAccess(userId) {
            if (!confirm('Revoke access?')) return;
            let users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            users = users.map(user => user.id === userId ? { ...user, approved: false } : user);
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            alert('Access revoked!');
            loadDashboard();
        }

        function deleteUser(userId) {
            if (!confirm('Permanently delete this user?')) return;
            let users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            users = users.filter(user => user.id !== userId);
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            alert('User deleted!');
            loadDashboard();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-red-600', 'text-red-600');
                btn.classList.add('text-gray-400');
            });
            
            ['pendingTable', 'approvedTable', 'allTable', 'plansTable'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            
            document.getElementById(tab + 'Tab').classList.add('border-red-600', 'text-red-600');
            document.getElementById(tab + 'Tab').classList.remove('text-gray-400');
            document.getElementById(tab + 'Table').classList.remove('hidden');
        }

        function exportUserData() {
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const data = JSON.stringify(users, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `netflix-users-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            alert('User data exported successfully!');
        }

        function showSystemStats() {
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const pending = users.filter(u => !u.approved).length;
            const approved = users.filter(u => u.approved).length;
            
            const planCounts = {};
            users.forEach(u => {
                const plan = (u.planName || 'Standard').toLowerCase();
                planCounts[plan] = (planCounts[plan] || 0) + 1;
            });
            
            const stats = `
System Analytics Report
=======================
Total Users: ${users.length}
Pending Approvals: ${pending}
Approved Users: ${approved}
Approval Rate: ${users.length > 0 ? ((approved / users.length) * 100).toFixed(1) : 0}%

Plan Distribution:
- Mobile: ${planCounts.mobile || 0}
- Basic: ${planCounts.basic || 0}
- Standard: ${planCounts.standard || 0}
- Premium: ${planCounts.premium || 0}

Payment Methods:
- Card: ${users.filter(u => u.paymentMethod === 'card').length}
- bKash: ${users.filter(u => u.paymentMethod === 'bkash').length}
- Nagad: ${users.filter(u => u.paymentMethod === 'nagad').length}
- Rocket: ${users.filter(u => u.paymentMethod === 'rocket').length}

Latest Registration: ${users.length > 0 ? new Date(users[users.length - 1].registeredAt).toLocaleString() : 'N/A'}
            `;
            
            alert(stats);
        }

        function clearAllData() {
            if (!confirm('‚ö†Ô∏è WARNING: This will delete ALL user data permanently. Are you absolutely sure?')) return;
            if (!confirm('This action CANNOT be undone. Type YES in the next prompt to confirm.')) return;
            
            const confirmation = prompt('Type "DELETE ALL" to confirm:');
            if (confirmation === 'DELETE ALL') {
                localStorage.removeItem('registeredUsers');
                alert('All user data has been cleared!');
                loadDashboard();
            } else {
                alert('Action cancelled.');
            }
        }

        function handleLogout() {
            if (confirm('Logout from admin panel?')) {
                localStorage.removeItem('currentAdmin');
                window.location.href = 'signin.html';
            }
        }

        loadDashboard();
    </script>
</body>
</html>